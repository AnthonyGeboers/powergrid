<!DOCTYPE html>
<html>
	<head>
		<title>PowerGrid proof of concept</title>
        <script src="../bower_components/requirejs/require.js" type="text/javascript"></script>
        <script src="config.js" type="text/javascript"></script>
        
		<link href="powergrid.css" rel="stylesheet" />
		<script>
			require(['jquery', 'powergrid', 'arraydatasource', 'promise', 'override'], function($, powergrid, ArrayDataSource, Promise, override) {
                if(window.requestAnimationFrame === undefined) {
                    requestAnimationFrame = function(f) {
                        setTimeout(f, 0);
                    };
                }
                
                var columns = [
                    { title: "Number", key: "x", width: 200, subViewToggle: true, subViewToggleClass: "pg-info", editable: true },
                    { title: "Description", key: "description", width: 300 }
                ];
                
                var data = [];
                var content = "";
                
                for(var x=0;x<500;x++) {
                    content += x + "<br/>";
                    data.push({
                        id: x,
                        description: "Row " + x,
                        x: x,
                        content: content
                    });
                }
                
                var ds = new ArrayDataSource(data);
                override(ds, function($super) {
                    return {
                        setValue: function(rowIdx, key, value) {
                            $super.setValue(rowIdx, key, value);
                            if(key === 'x') {
                                this.setValue(rowIdx, 'description', "Row " + value);
                            }
                        }
                    }
                });
                
                $("#test").PowerGrid({
                    columns: columns,
                    
                    dataSource: ds,
                    
                    extensions: {
                        'columnsizing': {},
                        'columnmoving': {},
                        'editing': true,
                        'subview': {
                            hasSubView: function(grid, record) {
                                return true;
                            },
                            
                            renderSubView: function(grid, record, target) {
                                return new Promise(function(resolve, reject) {
                                    setTimeout(function() {
                                        target.html(record.content); 
                                        resolve();
                                    }, 100);
                                });
                            }
                        }
                    }
                });
            });
		</script>
        
        <style>
            * {
                font-family: sans-serif;
                font-size: 11pt;
            }

            body {
                position: absolute;
                width: 100%;
                height: 100%;
                padding: 0;
                margin: 0;
            }

            #test {
                width: 100%;
                height: 100%;
            }
            
            .pg-subview {
                padding: 10px;
            }
        </style>
	</head>
	<body>
		<div id="test"></div>
	</body>
</html>